<!-- TOC -->

- [面向对象](#面向对象)
- [单元测试](#单元测试)
- [MySQL](#mysql)
- [多线程](#多线程)
    - [定时终止线程](#定时终止线程)
    - [获取当前执行的线程对象](#获取当前执行的线程对象)
- [软件工程](#软件工程)
    - [测试](#测试)
- [原则](#原则)

<!-- /TOC -->
# 面向对象

使用设计模式是已经验证的一种正确的编程方式。但是要搞清楚主次，以及我们为什么要使用设计模式。

例如，为了实现高内聚，低耦合，我们通常要求使用接口。接口是对一系列行为总结归纳之后的结果，人类习惯先有实践，然后才能根据实践总结出通用的经验。所以在编程的时候不要强求一定要一开始就设计接口，而是先进行实现类设计，然后把需要开放给外部调用方使用的“能力”当作接口开放出去。

# 单元测试

经常有人提到看起来很美的TDD，由高级的程序员，先设计好一个功能实现的目标，然后再有低级程序员去完成实现。但是即使再有经验的人，仍旧有犯错的地方，特别是在单元测试这种要求尽量充分覆盖所有情况的工作当中。

所以，我一般变成仍旧是先做实现，然后根据实现中的相关经验，能够归纳出来几个常见的单元测试场景。

在后续代码的联合调试中，一旦遇到某个单元出现bug，需要把这种情况抽离成一种单元测试用例，在这样的一个过程中，一步步完善你的代码。

难以想象在一个稍微复杂的算法中，没有单元测试如何确保算法的正确性。

# MySQL

做了读写分离的情况下，如果没有做特殊处理，直连查询的话。那么业务上就必须接受可能存在刚刚保存的数据，后续的请求无法查询到的情况。

针对这种问题：
1、订阅MySQL，binlog等到主库同步完了，再查从库
2、说服业务上要接受
3、在一次请求中，避免先保存后查询的情况，如果必须这样做，后续查询需要手动控制使用同一个数据源。例如都在writer dao中查询。

# 多线程

## 定时终止线程

控制线程超时，适用Future的get方法，有TimeoutException可以用来控制线程超时。

适用Thread.interrupt，需要自己判断线程状态来终止线程状态。

但是要注意，get方法是在调用的时候开始计时，所以，如果使用了线程池，线程到了Queue中，排队时间也会算在超时时间里面！

这时候需要用一个线程安全的变量，来判断线程是否已经开始执行。

## 获取当前执行的线程对象



如果我们new 一个Thread，名字未thread。

使用线程池执行，service.execute(thread)

在这个thread的run()方法中，如何获取当前执行的线程对象呢？

一开始我想当然的一位直接使用this就可以了，但是发现他的getState状态一直为NEW，说明执行的不是这个线程。这时候我想当然的以为，肯定是线程池自己维护了Thread对象，因为service.execute的入参是Runnable。

经过看线程池的代码，发现的确如此。我们使用this可以获取到thread对象，是因为Thread也实现了Runnable。但是线程池只是把它当作入参来使用，并没有使用这个线程对象。

如果想要获取当前执行的线程，还是应该使用 Thread.currentThread

# 软件工程

## 测试

在一个产品的萌芽阶段，往往都会适当的减少测试的强度，以让产品能够尽快上线进行试错。但是很多团队在产品真正做大的时候，却仍旧沿袭了以前的习惯，没有在后面把测试的重要性重新捡起来。

对于一个相当复杂的系统，如果没有一个文档化的测试方向，是很可怕的。在很多时候，如果只测试了正流程，那么整个测试过程也就只完成了30%而已。在这之外，还有大量的其他情况，反向情况没有测试到。

更容易暴露问题的是，数据量的增大，导致的异常问题。在开发环境和测试环境中，由于没有足够的数据量，很多问题没有暴露。

典型的是：
- 内存溢出
- RPC方法因数据量响应缓慢而超时
- 远程API方法并发限制

等等这类问题都是整个软件研发过程中非常难以处理的问题。很难每次都考虑到这么全面。当然，有经验的程序员可以提前预知到，但是当一个项目上线时间很紧张，以至于无法做到仔细评估整个流程时，那么问题就多了。

所以，我们程序员，在面对老板、产品经理的开发周期压力时，应当自己负好责任，将开发时间做尽可能完善的评估，考虑到尽可能完善的测试用例。做好自己的事情，确保自己的环节不能出问题。

# 原则

- 所有可能返回大量数据的远程方法调用，需要分页，或者是限制最多返回的数据量
- Redis的value不能存储太大的数据，string小于10k，list、set等，小于1000条
    - Redis的value不能频繁set，会导致产生大量的AOF文件，以至于磁盘慢，无法执行RDB快照任务，使得Redis无法使用
    - 同类型的Redis value，可以考虑使用Map结构，通过hset、hget、hdel来执行操作。